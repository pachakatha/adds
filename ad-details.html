<!DOCTYPE html>
<html lang="si">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ඇඩ් විස්තර - Adds Ink</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        :root { --green: #27ae60; --light-green: #2ecc71; }
        body { font-family: sans-serif; background: #f0f2f5; margin: 0; padding: 15px; }
        .ad-card { max-width: 500px; margin: auto; background: white; border-radius: 12px; overflow: hidden; box-shadow: 0 4px 10px rgba(0,0,0,0.1); }
        .green-header { background: var(--green); color: white; padding: 15px; text-align: center; }
        .content { padding: 20px; }
        .category-tag { background: #e8f5e9; color: var(--green); padding: 5px 12px; border-radius: 20px; font-size: 13px; font-weight: bold; }
        h2 { margin: 15px 0 5px 0; color: #333; }
        .location { color: #666; font-size: 14px; margin-bottom: 15px; }
        .desc { line-height: 1.6; color: #444; border-top: 1px solid #eee; padding-top: 15px; }
        
        /* Buttons */
        .action-btns { display: flex; flex-direction: column; gap: 10px; margin-top: 20px; }
        .btn { display: flex; align-items: center; justify-content: center; padding: 12px; border-radius: 8px; text-decoration: none; font-weight: bold; color: white; border: none; cursor: pointer; }
        .btn-call { background: var(--green); }
        .btn-wa { background: #25D366; }
        .btn i { margin-right: 8px; }

        /* Social Share */
        .share-bar { display: flex; justify-content: space-around; padding: 20px; border-top: 1px solid #eee; margin-top: 20px; }
        .share-btn { font-size: 22px; color: #555; cursor: pointer; transition: 0.2s; }
        .share-btn:hover { color: var(--green); }
        #loader { text-align: center; margin-top: 50px; font-weight: bold; color: var(--green); }
    </style>
</head>
<body>

<div id="loader">දත්ත පරීක්ෂා කරමින්...</div>

<div class="ad-card" id="ad-page" style="display:none;">
    <div class="green-header">
        <h3 style="margin:0;">භාණ්ඩයේ විස්තර</h3>
    </div>
    
    <div class="content">
        <span class="category-tag" id="view-category">Category</span>
        <h2 id="view-name">භාණ්ඩයේ නම</h2>
        <div class="location"><i class="fas fa-map-marker-alt"></i> <span id="view-location">ස්ථානය</span></div>
        
        <div class="desc" id="view-desc">විස්තරය මෙතනට...</div>

        <div class="action-btns">
            <a href="" id="call-link" class="btn btn-call"><i class="fas fa-phone"></i> Call කරන්න</a>
            <a href="" id="wa-link" target="_blank" class="btn btn-wa"><i class="fab fa-whatsapp"></i> WhatsApp පණිවිඩයක්</a>
        </div>
    </div>

    <div class="share-bar">
        <i class="fab fa-facebook share-btn" onclick="share('fb')"></i>
        <i class="fab fa-whatsapp share-btn" onclick="share('wa')"></i>
        <i class="fas fa-link share-btn" onclick="copyURL()"></i>
    </div>
</div>

<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
    import { getFirestore, doc, getDoc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

    const firebaseConfig = {
        apiKey: "AIzaSyDtOz0AMlrjcN7xfmkFuhQUU8Zl0MfQMSE",
        authDomain: "adds-ink.firebaseapp.com",
        projectId: "adds-ink",
        storageBucket: "adds-ink.firebasestorage.app",
        messagingSenderId: "638657776631",
        appId: "1:638657776631:web:44ffdad33137bfefa57cf2",
        measurementId: "G-Z002TVT7QX"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    // URL එකෙන් ඇඩ් එකේ ID එක ගන්න (details.html?id=ඇඩ්_අයිඩී_එක)
    const params = new URLSearchParams(window.location.search);
    const adId = params.get('id');

    async function getAdDetails() {
        if (!adId) {
            document.getElementById('loader').innerText = "ඇඩ් එකක් තෝරා නැත!";
            return;
        }

        try {
            // "ads" කියන collection එක පරීක්ෂා කරන්න
            const docRef = doc(db, "ads", adId); 
            const docSnap = await getDoc(docRef);

            if (docSnap.exists()) {
                const data = docSnap.data();

                // දත්ත පෙන්වීම (ඔබේ Firestore Field Names මේවා විය යුතුය)
                document.getElementById('view-name').innerText = data.name || data.title || "නමක් නැත";
                document.getElementById('view-category').innerText = data.category || "Normal";
                document.getElementById('view-location').innerText = data.location || "ස්ථානය සටහන් කර නැත";
                document.getElementById('view-desc').innerText = data.description || "විස්තරයක් නැත";
                
                // Call & WhatsApp links
                const phone = data.phone || data.number;
                document.getElementById('call-link').href = "tel:" + phone;
                document.getElementById('wa-link').href = "https://wa.me/94" + phone;

                document.getElementById('loader').style.display = 'none';
                document.getElementById('ad-page').style.display = 'block';
            } else {
                document.getElementById('loader').innerText = "දත්ත සොයාගත නොහැක! (ID වැරදියි)";
            }
        } catch (e) {
            document.getElementById('loader').innerText = "දත්ත ලබාගැනීමේ දෝෂයක්: " + e.message;
        }
    }

    getAdDetails();
</script>

<script>
    function share(platform) {
        const url = window.location.href;
        if(platform === 'fb') window.open('https://www.facebook.com/sharer/sharer.php?u=' + url);
        if(platform === 'wa') window.open('https://api.whatsapp.com/send?text=' + url);
    }
    function copyURL() {
        navigator.clipboard.writeText(window.location.href);
        alert("Link එක කොපි විය!");
    }
</script>
</body>
</html>
