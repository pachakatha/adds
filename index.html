<!DOCTYPE html>
<html lang="si">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LankaAds | ‡∑Å‡∑ä‚Äç‡∂ª‡∑ì ‡∂Ω‡∂Ç‡∂ö‡∑è‡∑Ä‡∑ö ‡∑Ä‡∑í‡∑Å‡∑è‡∂Ω‡∂≠‡∂∏ ‡∑Ä‡∑ô‡∑Ö‡∂≥‡∂¥‡∑ú‡∑Ö</title>
    
    <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-auth-compat.js"></script>

    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: { primary: '#FF7F00', secondary: '#0071dc', dark: '#1A1A1A' },
                    borderRadius: { '4xl': '2rem' }
                }
            }
        }
    </script>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Poppins', sans-serif; scroll-behavior: smooth; }
        .hero-bg {
            background-image: linear-gradient(rgba(0, 0, 0, 0.7), rgba(0, 0, 0, 0.5)), url('https://images.unsplash.com/photo-1555529669-e69e7aa0ba9a?q=80&w=1600');
            background-size: cover; background-position: center;
        }
        .premium-card { border: 2px solid #FFD700; background: linear-gradient(145deg, #ffffff, #fffef0); box-shadow: 0 10px 20px rgba(255, 215, 0, 0.15); }
        .glass-effect { background: rgba(255, 255, 255, 0.95); backdrop-filter: blur(10px); }
        .category-sidebar button:hover { background: #fff7ed; color: #FF7F00; }
        .active-cat { background: #FF7F00 !important; color: white !important; }
        .banner-box { overflow: hidden; border-radius: 20px; margin-bottom: 20px; }
    </style>
</head>
<body class="bg-gray-50 text-gray-800">

    <div class="bg-dark text-white text-[10px] py-2">
        <div class="container mx-auto px-6 flex justify-between items-center opacity-80 uppercase tracking-widest font-bold">
            <div class="flex gap-4">
                <span>‡∂∏‡∑î‡∑Ö‡∑î ‡∑É‡∑è‡∂∏‡∑è‡∂¢‡∑í‡∂ö‡∂∫‡∑í‡∂±‡∑ä: <span id="userCount" class="text-primary">0</span></span>
                <span>‡∑É‡∂¢‡∑ì‡∑Ä‡∑ì ‡∂Ø‡∑ê‡∂±‡∑ä‡∑Ä‡∑ì‡∂∏‡∑ä: <span id="adCount" class="text-primary">0</span></span>
            </div>
            <div class="hidden md:block">LankaAds - Sri Lanka's Trusted Marketplace</div>
        </div>
    </div>

    <nav class="glass-effect sticky top-0 z-50 border-b border-gray-100 shadow-sm">
        <div class="container mx-auto px-4 md:px-6 py-3 flex justify-between items-center">
            <h1 class="text-2xl md:text-3xl font-black text-dark tracking-tighter cursor-pointer" onclick="window.location.href='index.html'">Lanka<span class="text-primary">Ads</span></h1>
            <div id="authButtons" class="flex items-center gap-2 md:gap-4"></div>
        </div>
    </nav>

    <div id="topBanner" class="container mx-auto px-6 mt-4"></div>

    <div class="hero-bg text-white relative overflow-hidden">
        <div class="container mx-auto px-6 py-16 text-center relative z-10">
            <h2 class="text-4xl md:text-5xl font-extrabold mb-4">‡∂î‡∂∂‡∂ß ‡∂Ö‡∑Ä‡∑Å‡∑ä‚Äç‡∂∫ ‡∂ï‡∂±‡∑ë‡∂∏ ‡∂Ø‡∑ô‡∂∫‡∂ö‡∑ä ‡∂∏‡∑í‡∂Ω‡∂Ø‡∑ì ‡∂ú‡∂±‡∑ä‡∂±</h2>
            
            <div class="max-w-4xl mx-auto glass-effect p-2 rounded-3xl md:rounded-full shadow-2xl flex flex-col md:flex-row gap-2 mt-8">
                <input type="text" id="searchInput" onkeyup="filterAds()" placeholder="‡∂∏‡∑ú‡∂±‡∑Ä‡∂Ø ‡∑É‡∑ú‡∂∫‡∂±‡∑ä‡∂±‡∑ö?" class="flex-[2] p-4 rounded-full text-dark outline-none bg-transparent px-6 text-lg">
                <select id="districtFilter" onchange="filterAds()" class="flex-1 p-4 rounded-full text-dark outline-none bg-gray-100 border-none px-6 font-bold cursor-pointer">
                    <option value="All">‡∂Ø‡∑í‡∑É‡∑ä‡∂≠‡∑ä‚Äç‡∂ª‡∑í‡∂ö‡∑ä‡∂ö‡∂∫</option>
                    <option value="Colombo">Colombo</option><option value="Gampaha">Gampaha</option><option value="Kandy">Kandy</option>
                    </select>
                <button onclick="filterAds()" class="bg-primary text-white px-10 py-4 rounded-full font-black hover:bg-orange-600 transition shadow-lg">‡∑É‡∑ú‡∂∫‡∂±‡∑ä‡∂±</button>
            </div>
        </div>
    </div>

    <div class="container mx-auto px-4 md:px-6 py-10">
        <div class="flex flex-col lg:flex-row gap-8">
            
            <div class="w-full lg:w-1/4">
                <div class="bg-white p-6 rounded-3xl border border-gray-100 shadow-sm sticky top-24">
                    <h4 class="font-black text-dark mb-5 border-b pb-2 uppercase text-xs tracking-widest">‡∑Ä‡∂ª‡∑ä‡∂ú‡∑ì‡∂ö‡∂ª‡∂´‡∂∫‡∂±‡∑ä</h4>
                    <div class="category-sidebar space-y-1">
                        <button onclick="setCategory('All')" class="w-full text-left p-3 rounded-xl font-bold text-sm transition flex items-center justify-between active-cat" id="cat-All">
                            <span>üè† ‡∑É‡∑í‡∂∫‡∂Ω‡∑î‡∂∏ ‡∂á‡∂©‡∑ä‡∑É‡∑ä</span>
                        </button>
                        <button onclick="setCategory('Electronics')" class="w-full text-left p-3 rounded-xl font-bold text-sm transition" id="cat-Electronics">üì± Electronics</button>
                        <button onclick="setCategory('Vehicles')" class="w-full text-left p-3 rounded-xl font-bold text-sm transition" id="cat-Vehicles">üöó Vehicles</button>
                        <button onclick="setCategory('Property')" class="w-full text-left p-3 rounded-xl font-bold text-sm transition" id="cat-Property">üè† Property</button>
                        <button onclick="setCategory('Home & Garden')" class="w-full text-left p-3 rounded-xl font-bold text-sm transition" id="cat-Home">üõãÔ∏è Home & Garden</button>
                        <button onclick="setCategory('Fashion & Beauty')" class="w-full text-left p-3 rounded-xl font-bold text-sm transition" id="cat-Fashion">üëó Fashion</button>
                        <button onclick="setCategory('Jobs')" class="w-full text-left p-3 rounded-xl font-bold text-sm transition" id="cat-Jobs">üíº Jobs</button>
                        <button onclick="setCategory('Animals')" class="w-full text-left p-3 rounded-xl font-bold text-sm transition" id="cat-Animals">üêï Animals</button>
                    </div>
                    
                    <div id="sideBanner" class="mt-8"></div>
                </div>
            </div>

            <div class="w-full lg:w-3/4">
                <div id="middleBanner"></div>

                <div class="flex justify-between items-center mb-6">
                    <h3 class="text-xl font-black text-dark uppercase tracking-tight">‡∂±‡∑Ä‡∂≠‡∂∏ ‡∂Ø‡∑ê‡∂±‡∑ä‡∑Ä‡∑ì‡∂∏‡∑ä - <span id="currentCategoryText" class="text-primary">‡∑É‡∑í‡∂∫‡∂Ω‡∑ä‡∂Ω</span></h3>
                    <a href="post-ad.html" class="bg-dark text-white px-6 py-2 rounded-xl font-bold text-xs hover:bg-primary transition shadow-lg">+ ‡∂á‡∂©‡∑ä ‡∂ë‡∂ö‡∂ö‡∑ä ‡∂Ø‡∑è‡∂±‡∑ä‡∂±</a>
                </div>

                <div id="adsGrid" class="grid grid-cols-1 sm:grid-cols-2 xl:grid-cols-3 gap-6">
                    </div>

                <div id="bottomBanner" class="mt-10"></div>
            </div>
        </div>
    </div>

    <script>
        // ‡∂î‡∂∂‡∂ú‡∑ö ‡∂±‡∑í‡∑Ä‡∑ê‡∂ª‡∂Ø‡∑í API Config
        const firebaseConfig = {
            apiKey: "AIzaSyDtOz0AMlrjcN7xfmkFuhQUU8Zl0MfQMSE",
            authDomain: "adds-ink.firebaseapp.com",
            projectId: "adds-ink",
            storageBucket: "adds-ink.firebasestorage.app",
            messagingSenderId: "638657776631",
            appId: "1:638657776631:web:44ffdad33137bfefa57cf2",
            measurementId: "G-Z002TVT7QX"
        };

        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();
        const auth = firebase.auth();

        let allAds = [];

        // 1. Load Banners from Admin
        function loadAdminBanners() {
            db.collection("banners").onSnapshot(snap => {
                const top = document.getElementById('topBanner');
                const mid = document.getElementById('middleBanner');
                const bottom = document.getElementById('bottomBanner');
                const side = document.getElementById('sideBanner');
                
                top.innerHTML = mid.innerHTML = bottom.innerHTML = side.innerHTML = "";

                snap.forEach(doc => {
                    const b = doc.data();
                    const html = `
                        <div class="banner-box bg-white border border-gray-100 shadow-sm p-4 mb-6">
                            ${b.img ? `<img src="${b.img}" class="w-full rounded-xl mb-3 h-auto object-cover">` : ''}
                            <div class="prose prose-sm max-w-none text-sm">${b.content}</div>
                        </div>
                    `;
                    if(b.pos === 'top') top.innerHTML += html;
                    if(b.pos === 'middle') mid.innerHTML += html;
                    if(b.pos === 'bottom') bottom.innerHTML += html;
                    if(b.pos === 'side') side.innerHTML += html;
                });
            });
        }

        // 2. Load Stats (Users and Ads)
        function loadStats() {
            db.collection("posts").onSnapshot(snap => {
                document.getElementById('adCount').innerText = snap.size;
            });
            // Users ‡∂ú‡∂´‡∂± ‡∑É‡∂≥‡∑Ñ‡∑è (‡∂∏‡∑ô‡∂∫ Users collection ‡∂ë‡∂ö‡∂ö‡∑ä ‡∂≠‡∑í‡∂∂‡∑ö ‡∂±‡∂∏‡∑ä ‡∂¥‡∂∏‡∂´‡∑í)
            db.collection("users").onSnapshot(snap => {
                document.getElementById('userCount').innerText = snap.size || '150+';
            });
        }

        // 3. Fetch Ads (ikman style logic)
        function fetchAds() {
            db.collection("posts").where("status", "==", "approved").orderBy("isPremium", "desc").orderBy("createdAt", "desc")
            .onSnapshot(snapshot => {
                allAds = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
                renderAds(allAds);
            });
        }

        function renderAds(ads) {
            const grid = document.getElementById('adsGrid');
            grid.innerHTML = ads.length === 0 ? "<p class='col-span-full text-center py-20 text-gray-400 font-bold'>‡∂Ø‡∑ê‡∂±‡∑ä‡∑Ä‡∑ì‡∂∏‡∑ä ‡∂ö‡∑í‡∑É‡∑í‡∑Ä‡∂ö‡∑ä ‡∑Ñ‡∂∏‡∑î ‡∂±‡∑ú‡∑Ä‡∑ì‡∂∫.</p>" : "";

            ads.forEach(ad => {
                const isPremium = ad.isPremium === true;
                grid.innerHTML += `
                    <div class="group bg-white rounded-3xl p-3 border border-gray-100 hover:shadow-xl transition-all duration-300 ${isPremium ? 'premium-card' : ''}">
                        <div class="relative h-44 rounded-2xl overflow-hidden mb-3">
                            <img src="${ad.imageUrl || 'https://via.placeholder.com/300x200'}" class="w-full h-full object-cover group-hover:scale-110 transition duration-500">
                            ${isPremium ? '<span class="absolute top-2 left-2 bg-amber-500 text-white text-[10px] font-black px-3 py-1 rounded-full uppercase shadow-lg">‚≠ê PREMIUM</span>' : ''}
                        </div>
                        <div class="px-2">
                            <span class="text-[9px] font-black text-primary bg-orange-50 px-2 py-0.5 rounded uppercase">${ad.category}</span>
                            <h3 class="text-sm font-bold text-dark mt-2 line-clamp-1 uppercase tracking-tight">${ad.title}</h3>
                            <p class="text-[10px] text-gray-400 font-medium">üìç ${ad.district}</p>
                            <div class="flex justify-between items-center mt-4 pt-3 border-t border-gray-50">
                                <span class="font-black text-sm text-dark">‡∂ª‡∑î. ${Number(ad.price).toLocaleString()}</span>
                                <a href="ad-details.html?id=${ad.id}" class="text-[10px] font-black bg-slate-900 text-white px-3 py-2 rounded-lg hover:bg-primary transition uppercase">‡∑Ä‡∑í‡∑É‡∑ä‡∂≠‡∂ª</a>
                            </div>
                        </div>
                    </div>
                `;
            });
        }

        function setCategory(cat) {
            document.getElementById('currentCategoryText').innerText = (cat === 'All') ? '‡∑É‡∑í‡∂∫‡∂Ω‡∑ä‡∂Ω' : cat;
            document.querySelectorAll('.category-sidebar button').forEach(b => b.classList.remove('active-cat'));
            document.getElementById('cat-' + cat.replace(' & ', '')).classList.add('active-cat');
            
            if (cat === 'All') renderAds(allAds);
            else renderAds(allAds.filter(ad => ad.category === cat));
        }

        function filterAds() {
            const search = document.getElementById('searchInput').value.toLowerCase();
            const dist = document.getElementById('districtFilter').value;
            const filtered = allAds.filter(ad => (dist === "All" || ad.district === dist) && ad.title.toLowerCase().includes(search));
            renderAds(filtered);
        }

        // Auth Logic (‡∂î‡∂∂‡∑ö ‡∂¥‡∑ê‡∂ª‡∂´‡∑í ‡∂ö‡∑ö‡∂≠‡∂∫ ‡∂ë‡∂Ω‡∑ô‡∑É‡∂∏ ‡∂≠‡∂∂‡∑è ‡∂á‡∂≠)
        auth.onAuthStateChanged(user => {
            const authDiv = document.getElementById('authButtons');
            if (user) {
                authDiv.innerHTML = `<div class='flex gap-2 items-center'><span class='text-xs font-bold'>${user.email.split('@')[0]}</span><button onclick='auth.signOut()' class='text-xs text-red-500 font-bold'>Log Out</button></div>`;
            } else {
                authDiv.innerHTML = `<a href="login.html" class="text-xs font-bold">Login</a><a href="signup.html" class="bg-primary text-white px-4 py-2 rounded-full text-xs font-bold">Sign Up</a>`;
            }
        });

        window.onload = () => { fetchAds(); loadAdminBanners(); loadStats(); };
    </script>
</body>
</html>
