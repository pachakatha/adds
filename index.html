<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lanka Ads - No. 1 Marketplace</title>
    
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">

    <style>
        :root {
            --primary: #007bff;
            --secondary: #ffc107; /* Gold */
            --premium-red: #ff4d4d;
            --dark: #2d3436;
        }

        body { font-family: 'Inter', sans-serif; margin: 0; background-color: #f0f2f5; color: var(--dark); }

        /* Navigation */
        nav { background: white; padding: 12px 6%; display: flex; justify-content: space-between; align-items: center; box-shadow: 0 2px 10px rgba(0,0,0,0.1); position: sticky; top: 0; z-index: 1000; }
        .logo { font-size: 28px; font-weight: 800; color: var(--primary); text-decoration: none; }
        .auth-buttons { display: flex; gap: 15px; align-items: center; }
        .btn-signup { background: var(--primary); color: white; padding: 10px 24px; border-radius: 8px; text-decoration: none; font-weight: 700; }
        #profile-link { display: none; text-decoration: none; background: #e9ecef; color: var(--dark); padding: 8px 18px; border-radius: 20px; font-weight: 600; border: 1px solid #ddd; }
        
        /* CHAT Link Styling */
        #chat-link { display: none; text-decoration: none; color: var(--dark); font-weight: 600; padding: 8px 15px; border-radius: 20px; transition: 0.3s; }
        #chat-link:hover { color: var(--primary); background: #f0f2f5; }

        /* Language Selector */
        .lang-selector { padding: 5px; border-radius: 5px; border: 1px solid #ddd; cursor: pointer; }

        /* Hero & Search */
        .hero { background: linear-gradient(rgba(0,0,0,0.6), rgba(0,0,0,0.6)), url('https://images.unsplash.com/photo-1556742049-0cfed4f6a45d?auto=format&fit=crop&w=1350&q=80'); background-size: cover; background-position: center; height: 400px; display: flex; flex-direction: column; justify-content: center; align-items: center; color: white; text-align: center; padding: 0 20px; }
        .hero h1 { font-size: 38px; margin-bottom: 10px; font-weight: 800; }
        .search-container { width: 90%; max-width: 1000px; background: white; padding: 20px; border-radius: 15px; display: flex; flex-wrap: wrap; gap: 10px; margin-top: -50px; box-shadow: 0 10px 30px rgba(0,0,0,0.2); }
        .search-container select, .search-container input { flex: 1; min-width: 150px; padding: 15px; border: 1px solid #ddd; border-radius: 8px; outline: none; }
        .btn-search { background: var(--primary); color: white; border: none; padding: 0 30px; border-radius: 8px; font-weight: 700; cursor: pointer; }

        /* Categories */
        .categories { padding: 60px 6% 20px; display: grid; grid-template-columns: repeat(auto-fill, minmax(100px, 1fr)); gap: 15px; text-align: center; }
        .cat-item { background: white; padding: 15px; border-radius: 12px; cursor: pointer; transition: 0.3s; box-shadow: 0 2px 5px rgba(0,0,0,0.05); }
        .cat-item i { font-size: 24px; color: var(--primary); margin-bottom: 8px; display: block; }
        .cat-item span { font-size: 12px; font-weight: 600; }

        /* Ads Grid */
        .ads-section { padding: 30px 6%; }
        .section-title { font-size: 22px; font-weight: 800; margin-bottom: 20px; border-left: 5px solid var(--primary); padding-left: 15px; }
        .ads-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(250px, 1fr)); gap: 20px; }

        /* Ad Card */
        .ad-card { background: white; border-radius: 12px; overflow: hidden; box-shadow: 0 4px 10px rgba(0,0,0,0.05); position: relative; transition: 0.3s; text-decoration: none; color: inherit; display: block; }
        .ad-card:hover { transform: translateY(-5px); }
        .premium-card { border: 3px solid var(--premium-red); outline: 3px solid var(--secondary); }
        .ad-card img { width: 100%; height: 170px; object-fit: cover; background: #eee; }
        .ad-content { padding: 15px; }
        .ad-price { color: var(--primary); font-size: 18px; font-weight: 800; }
        .ad-title { font-weight: 600; margin: 5px 0; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
        .premium-badge { position: absolute; top: 10px; left: 10px; background: var(--premium-red); color: white; padding: 4px 10px; font-size: 11px; font-weight: 800; border-radius: 5px; }

        /* Floating Button */
        .btn-post { position: fixed; bottom: 30px; right: 30px; width: 65px; height: 65px; background: #28a745; color: white; border-radius: 50%; display: flex; justify-content: center; align-items: center; font-size: 28px; box-shadow: 0 6px 20px rgba(0,0,0,0.2); text-decoration: none; z-index: 1001; }
        
        .loading-text { text-align: center; grid-column: 1/-1; padding: 50px; color: #888; }
    </style>
</head>
<body>

    <nav>
        <a href="index.html" class="logo">Lanka Ads</a>
        <div class="auth-buttons">
            <select id="languageSelect" class="lang-selector" onchange="changeLanguage()">
                <option value="en">English</option>
                <option value="si">සිංහල</option>
                <option value="ta">தமிழ்</option>
            </select>
            
            <a href="comment.html" id="chat-link"><i class="fas fa-comments"></i> CHAT</a>

            <div id="auth-box">
                <a href="login.html" style="text-decoration:none; color:var(--dark); font-weight:600;" id="login-text">Log In</a>
                <a href="signup.html" class="btn-signup" id="signup-text">Sign Up</a>
            </div>
            <a href="profile.html" id="profile-link"><i class="fas fa-user-circle"></i> Profile</a>
        </div>
    </nav>

    <section class="hero">
        <h1 id="hero-title">Buy & Sell Securely in Sri Lanka</h1>
        <p id="hero-subtitle">Your local marketplace for all your needs.</p>
        <div class="search-container">
            <select id="district-select">
                <option value="">All Districts</option>
                <option>Colombo</option><option>Gampaha</option><option>Kandy</option><option>Galle</option><option>Matara</option><option>Jaffna</option><option>Kurunegala</option><option>Kalutara</option><option>Anuradhapura</option><option>Ratnapura</option><option>Badulla</option><option>Kegalle</option><option>Puttalam</option><option>Trincomalee</option><option>Batticaloa</option><option>Ampara</option><option>Matale</option><option>Nuwara Eliya</option><option>Hambantota</option><option>Vavuniya</option><option>Mannar</option><option>Mullaitivu</option><option>Kilinochchi</option><option>Polonnaruwa</option><option>Moneragala</option>
            </select>
            <select id="category-select">
                <option value="">All Categories</option>
                <option>Mobiles</option><option>Vehicles</option><option>Property</option><option>Electronics</option><option>Fashion</option><option>Jobs</option>
            </select>
            <input type="text" id="search-input" placeholder="Search for anything...">
            <button class="btn-search" id="search-btn">Search</button>
        </div>
    </section>

    <div class="categories">
        <div class="cat-item"><i class="fas fa-mobile-alt"></i><span>Mobiles</span></div>
        <div class="cat-item"><i class="fas fa-car"></i><span>Vehicles</span></div>
        <div class="cat-item"><i class="fas fa-home"></i><span>Property</span></div>
        <div class="cat-item"><i class="fas fa-laptop"></i><span>Electronics</span></div>
        <div class="cat-item"><i class="fas fa-tshirt"></i><span>Fashion</span></div>
        <div class="cat-item"><i class="fas fa-briefcase"></i><span>Jobs</span></div>
    </div>

    <div class="ads-section">
        <div class="section-title" id="featured-title">Featured Ads</div>
        <div class="ads-grid" id="premium-grid">
            <div class="loading-text">Loading premium ads...</div>
        </div>

        <div class="section-title" id="recent-title" style="margin-top: 40px;">Recent Ads</div>
        <div class="ads-grid" id="latest-grid">
            <div class="loading-text">Loading ads...</div>
        </div>
    </div>

    <a href="post-ad.html" class="btn-post"><i class="fas fa-plus"></i></a>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
        import { getFirestore, collection, getDocs, query, orderBy } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyDtOz0AMlrjcN7xfmkFuhQUU8Zl0MfQMSE",
            authDomain: "adds-ink.firebaseapp.com",
            projectId: "adds-ink",
            storageBucket: "adds-ink.firebasestorage.app",
            messagingSenderId: "638657776631",
            appId: "1:638657776631:web:44ffdad33137bfefa57cf2"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);

        // Login Status - CHAT link visibility added here
        onAuthStateChanged(auth, (user) => {
            if (user) {
                document.getElementById('auth-box').style.display = 'none';
                document.getElementById('profile-link').style.display = 'block';
                document.getElementById('chat-link').style.display = 'block'; // Show Chat
            } else {
                document.getElementById('auth-box').style.display = 'flex';
                document.getElementById('profile-link').style.display = 'none';
                document.getElementById('chat-link').style.display = 'none'; // Hide Chat
            }
        });

        // Google Drive Link Fix
        function convertDriveLink(url) {
            if (url && url.includes('drive.google.com')) {
                let id = "";
                if (url.includes('/d/')) id = url.split('/d/')[1].split('/')[0];
                else if (url.includes('id=')) id = url.split('id=')[1].split('&')[0];
                return id ? `https://drive.google.com/uc?export=view&id=${id}` : url;
            }
            return url;
        }

        async function fetchAds() {
            const premiumGrid = document.getElementById('premium-grid');
            const latestGrid = document.getElementById('latest-grid');

            try {
                const q = query(collection(db, "posts"), orderBy("createdAt", "desc"));
                const querySnapshot = await getDocs(q);
                
                let premiumHTML = "";
                let latestHTML = "";

                querySnapshot.forEach((doc) => {
                    const ad = doc.data();
                    const adId = doc.id;
                    const imageUrl = convertDriveLink(ad.imageUrl);
                    const isPremium = ad.premiumStatus === "active" || ad.isPremium === true;

                    const adHTML = `
                        <a href="ad-details.html?id=${adId}" class="ad-card ${isPremium ? 'premium-card' : ''}">
                            ${isPremium ? '<div class="premium-badge">PREMIUM</div>' : ''}
                            <img src="${imageUrl}" onerror="this.src='https://via.placeholder.com/300?text=No+Image'">
                            <div class="ad-content">
                                <div class="ad-title">${ad.title}</div>
                                <div class="ad-price">Rs. ${parseFloat(ad.price).toLocaleString()}</div>
                                <div style="font-size:12px; color:#777;"><i class="fas fa-map-marker-alt"></i> ${ad.district}</div>
                            </div>
                        </a>
                    `;

                    if (isPremium) premiumHTML += adHTML;
                    else latestHTML += adHTML;
                });

                premiumGrid.innerHTML = premiumHTML || '<p class="loading-text">No featured ads.</p>';
                latestGrid.innerHTML = latestHTML || '<p class="loading-text">No ads found.</p>';

            } catch (e) {
                console.error(e);
            }
        }

        fetchAds();
    </script>
    
    <script>
        // Language Translation System
        const translations = {
            'en': {
                'hero-title': 'Buy & Sell Securely in Sri Lanka',
                'hero-subtitle': 'Your local marketplace for all your needs.',
                'search-btn': 'Search',
                'featured-title': 'Featured Ads',
                'recent-title': 'Recent Ads',
                'login-text': 'Log In',
                'signup-text': 'Sign Up'
            },
            'si': {
                'hero-title': 'ශ්‍රී ලංකාවේ ආරක්ෂිතව මිලදී ගන්න සහ විකුණන්න',
                'hero-subtitle': 'ඔබේ සියලු අවශ්‍යතා සඳහා දේශීය වෙළඳපොළ.',
                'search-btn': 'සොයන්න',
                'featured-title': 'ප්‍රිමියම් දැන්වීම්',
                'recent-title': 'නවතම දැන්වීම්',
                'login-text': 'ඇතුල් වන්න',
                'signup-text': 'ගිණුමක් සාදන්න'
            },
            'ta': {
                'hero-title': 'இலங்கையில் பாதுகாப்பாக வாங்கவும் விற்கவும்',
                'hero-subtitle': 'உங்கள் அனைத்து தேவைகளுக்கும் உங்கள் உள்ளூர் சந்தை.',
                'search-btn': 'தேடுங்கள்',
                'featured-title': 'சிறப்பு விளம்பரங்கள்',
                'recent-title': 'சமீபத்திய விளம்பரங்கள்',
                'login-text': 'உள்நுழைய',
                'signup-text': 'பதிவு செய்யவும்'
            }
        };

        function changeLanguage() {
            const lang = document.getElementById('languageSelect').value;
            document.getElementById('hero-title').innerText = translations[lang]['hero-title'];
            document.getElementById('hero-subtitle').innerText = translations[lang]['hero-subtitle'];
            document.getElementById('search-btn').innerText = translations[lang]['search-btn'];
            document.getElementById('featured-title').innerText = translations[lang]['featured-title'];
            document.getElementById('recent-title').innerText = translations[lang]['recent-title'];
            document.getElementById('login-text').innerText = translations[lang]['login-text'];
            document.getElementById('signup-text').innerText = translations[lang]['signup-text'];
        }
    </script>
</body>
</html>
