<!DOCTYPE html>
<html lang="si">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LankaAds | ‡∑Å‡∑ä‚Äç‡∂ª‡∑ì ‡∂Ω‡∂Ç‡∂ö‡∑è‡∑Ä‡∑ö ‡∑Ä‡∑í‡∑Å‡∑è‡∂Ω‡∂≠‡∂∏ ‡∑Ä‡∑ô‡∑Ö‡∂≥‡∂¥‡∑ú‡∑Ö</title>

    <link rel="manifest" href="/manifest.json">
    <meta name="theme-color" content="#FF7F00">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <link rel="apple-touch-icon" href="icon-192.png">

    <meta name="google-site-verification" content="r8dfB82ybIIQNDVmhwz88AzJwMK_yVTbs_TAuDa53YE" />
    
    <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-auth-compat.js"></script>

    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#FF7F00',
                        secondary: '#0071dc',
                        dark: '#1A1A1A',
                    },
                    borderRadius: { '4xl': '2rem' }
                }
            }
        }
    </script>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Poppins', sans-serif; scroll-behavior: smooth; padding-bottom: 70px; }
        .hero-bg {
            background-image: linear-gradient(rgba(0, 0, 0, 0.7), rgba(0, 0, 0, 0.5)), url('https://images.unsplash.com/photo-1555529669-e69e7aa0ba9a?q=80&w=1600');
            background-size: cover; background-position: center;
        }
        .premium-card {
            border: 2px solid #FFD700;
            background: linear-gradient(145deg, #ffffff, #fffef0);
            box-shadow: 0 15px 30px rgba(255, 215, 0, 0.2);
        }
        .premium-tag { background: linear-gradient(90deg, #f59e0b, #fbbf24); }
        .glass-effect { background: rgba(255, 255, 255, 0.9); backdrop-filter: blur(10px); }
        .category-card:hover { transform: translateY(-5px); transition: 0.3s; }
        
        /* Mobile Bottom Nav Styling */
        .bottom-nav { position: fixed; bottom: 0; left: 0; right: 0; background: white; display: flex; justify-content: space-around; padding: 10px 0; border-top: 1px solid #eee; z-index: 1000; }
        @media (min-width: 768px) { .bottom-nav { display: none; } }
    </style>
</head>
<body class="bg-gray-50 text-gray-800">

    <nav class="glass-effect sticky top-0 z-50 border-b border-gray-100 shadow-sm">
        <div class="container mx-auto px-4 md:px-6 py-3 flex justify-between items-center">
            <h1 class="text-2xl md:text-3xl font-black text-dark tracking-tighter cursor-pointer" onclick="window.location.href='index.html'">Lanka<span class="text-primary">Ads</span></h1>
            <div id="authButtons" class="flex items-center gap-2 md:gap-4"></div>
        </div>
    </nav>

    <div class="hero-bg text-white relative overflow-hidden">
        <div class="container mx-auto px-6 py-12 text-center relative z-10">
            <h2 class="text-3xl md:text-6xl font-extrabold leading-tight mb-4">‡∂Ω‡∂Ç‡∂ö‡∑è‡∑Ä‡∑ö ‡∂Ö‡∂Ç‡∂ö ‡∂ë‡∂ö‡∑ö <span class="text-primary">‡∑Ä‡∑ô‡∑Ö‡∂≥‡∂¥‡∑ú‡∑Ö</span></h2>
            
            <div class="max-w-4xl mx-auto glass-effect p-2 md:p-3 rounded-3xl md:rounded-full shadow-2xl flex flex-col md:flex-row gap-2">
                <input type="text" id="searchInput" onkeyup="filterAds()" placeholder="‡∑É‡∑ú‡∂∫‡∂±‡∑ä‡∂±..." class="flex-[2] p-4 rounded-full text-dark outline-none bg-transparent px-6">
                <select id="districtFilter" onchange="filterAds()" class="flex-1 p-4 rounded-full text-dark bg-gray-100 border-none cursor-pointer">
                    <option value="All">‡∂Ø‡∑í‡∑É‡∑ä‡∂≠‡∑ä‚Äç‡∂ª‡∑í‡∂ö‡∑ä‡∂ö‡∂∫</option>
                    <option value="Colombo">Colombo</option>
                    </select>
                <button onclick="filterAds()" class="bg-primary text-white px-8 py-4 rounded-full font-bold shadow-lg">‡∑É‡∑ú‡∂∫‡∂±‡∑ä‡∂±</button>
            </div>
        </div>
    </div>

    <div class="container mx-auto px-4 py-8">
        <div id="adsGrid" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6">
            <p class="text-gray-400 py-10 col-span-full text-center">‡∂¥‡∑ñ‡∂ª‡∂´‡∂∫ ‡∑Ä‡∑ô‡∂∏‡∑í‡∂±‡∑ä...</p>
        </div>
    </div>

    <div class="bottom-nav shadow-lg">
        <button onclick="window.location.href='index.html'" class="flex flex-col items-center text-primary">
            <span class="text-xl">üè†</span>
            <span class="text-[10px] font-bold uppercase">Home</span>
        </button>
        <button onclick="window.location.href='post-ad.html'" class="flex flex-col items-center text-gray-400">
            <span class="text-xl">‚ûï</span>
            <span class="text-[10px] font-bold uppercase">Sell</span>
        </button>
        <button onclick="window.location.href='profile.html'" class="flex flex-col items-center text-gray-400">
            <span class="text-xl">üë§</span>
            <span class="text-[10px] font-bold uppercase">Profile</span>
        </button>
    </div>

    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyDtOz0AMlrjcN7xfmkFuhQUU8Zl0MfQMSE",
            authDomain: "adds-ink.firebaseapp.com",
            projectId: "adds-ink",
            storageBucket: "adds-ink.firebasestorage.app",
            messagingSenderId: "638657776631",
            appId: "1:638657776631:web:44ffdad33137bfefa57cf2",
            measurementId: "G-Z002TVT7QX"
        };

        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();
        const auth = firebase.auth();

        // Register Service Worker for PWA
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('/service-worker.js')
                .then(reg => console.log('Service Worker Registered'))
                .catch(err => console.log('Service Worker Error', err));
            });
        }

        let allAds = [];

        auth.onAuthStateChanged(user => {
            const authDiv = document.getElementById('authButtons');
            if (user) {
                authDiv.innerHTML = `<button onclick="auth.signOut()" class="text-xs text-red-500 font-bold">Log Out</button>`;
            } else {
                authDiv.innerHTML = `<a href="login.html" class="text-sm font-bold text-primary">Login</a>`;
            }
        });

        function fetchAds() {
            db.collection("posts").orderBy("createdAt", "desc").onSnapshot(snapshot => {
                allAds = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
                renderAds(allAds);
            });
        }

        function renderAds(ads) {
            const grid = document.getElementById('adsGrid');
            grid.innerHTML = ads.length === 0 ? "<p class='col-span-full text-center'>‡∂Ø‡∑ê‡∂±‡∑ä‡∑Ä‡∑ì‡∂∏‡∑ä ‡∂±‡∑ê‡∂≠</p>" : "";
            ads.forEach(ad => {
                const isPremium = ad.isFeatured === true;
                grid.innerHTML += `
                    <div class="bg-white rounded-3xl p-3 border border-gray-100 shadow-sm ${isPremium ? 'premium-card' : ''}">
                        <div class="relative h-40 rounded-2xl overflow-hidden mb-3">
                            <img src="${ad.imageUrl}" class="w-full h-full object-cover">
                            <div class="absolute bottom-2 left-2 bg-white/90 px-2 py-1 rounded-lg text-xs font-bold">
                                ‡∂ª‡∑î. ${Number(ad.price).toLocaleString()}
                            </div>
                        </div>
                        <h3 class="text-xs font-bold text-dark truncate px-1">${ad.title}</h3>
                        <div class="flex justify-between items-center mt-3 px-1">
                            <span class="text-[10px] text-gray-400 uppercase">üìç ${ad.district || 'Lanka'}</span>
                            <a href="ad-details.html?id=${ad.id}" class="bg-dark text-white text-[10px] font-bold px-3 py-1.5 rounded-lg hover:bg-primary transition">‡∂∂‡∂Ω‡∂±‡∑ä‡∂±</a>
                        </div>
                    </div>
                `;
            });
        }

        function filterAds() {
            const text = document.getElementById('searchInput').value.toLowerCase();
            const dist = document.getElementById('districtFilter').value;
            const filtered = allAds.filter(ad => 
                ad.title.toLowerCase().includes(text) && (dist === "All" || ad.district === dist)
            );
            renderAds(filtered);
        }

        window.onload = fetchAds;
    </script>
</body>
</html>
