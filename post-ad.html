// 1. Firebase libraries import කිරීම
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.0.0/firebase-app.js";
import { getFirestore, collection, addDoc, serverTimestamp } from "https://www.gstatic.com/firebasejs/10.0.0/firebase-firestore.js";
import { getAuth } from "https://www.gstatic.com/firebasejs/10.0.0/firebase-auth.js";

// 2. ඔබ දුන් නව Configuration එක
const firebaseConfig = {
  apiKey: "AIzaSyDtOz0AMlrjcN7xfmkFuhQUU8Zl0MfQMSE",
  authDomain: "adds-ink.firebaseapp.com",
  projectId: "adds-ink",
  storageBucket: "adds-ink.firebasestorage.app",
  messagingSenderId: "638657776631",
  appId: "1:638657776631:web:44ffdad33137bfefa57cf2",
  measurementId: "G-Z002TVT7QX"
};

// 3. Firebase Initialize කිරීම
const app = initializeApp(firebaseConfig);
const db = getFirestore(app);
const auth = getAuth(app);

// 4. Post එක එකතු කිරීමේ function එක
async function addPost() {
  // HTML input fields වලින් අගයන් ලබා ගැනීම
  const titleInput = document.getElementById('postTitle');
  const contentInput = document.getElementById('postContent');
  
  const title = titleInput.value;
  const content = contentInput.value;

  // Input එක හිස් නම් නතර කිරීම
  if (title === "" || content === "") {
    alert("කරුණාකර මාතෘකාව සහ අන්තර්ගතය ඇතුළත් කරන්න.");
    return;
  }

  try {
    // Firestore එකට දත්ත එකතු කිරීම
    const docRef = await addDoc(collection(db, "posts"), {
      title: title,
      content: content,
      createdAt: serverTimestamp(),
      author: auth.currentUser ? auth.currentUser.uid : "Anonymous"
    });

    console.log("Post ID: ", docRef.id);
    alert("Post එක සාර්ථකව එකතු විය!");
    
    // Input fields හිස් කිරීම
    titleInput.value = "";
    contentInput.value = "";
    
  } catch (e) {
    console.error("දෝෂයක් ඇතිවිය: ", e);
    alert("Post එක එකතු කිරීමට නොහැකි විය.");
  }
}

// 5. Button එක click කළ විට function එක ක්‍රියාත්මක කිරීම
// HTML එකේ ඇති බොත්තමේ id එක 'submitBtn' බව තහවුරු කරගන්න
document.getElementById('submitBtn').addEventListener('click', addPost);
