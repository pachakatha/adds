<script>
    async function publishPost() {
        const user = auth.currentUser;
        if (!user) { alert("කරුණාකර ලොග් වන්න"); return; }

        const title = document.getElementById('postTitle').value;
        const category = document.getElementById('postCategory').value;
        const desc = document.getElementById('postDesc').value;
        const isFeatured = document.getElementById('featuredCheckbox').checked;
        const btn = document.getElementById('publishBtn');

        if (!title || !desc) { alert("විස්තර ඇතුළත් කරන්න"); return; }

        btn.disabled = true;
        btn.innerText = "Processing...";

        try {
            const postRef = await db.collection("posts").add({
                title: title,
                category: category,
                description: desc,
                userId: user.uid,
                userEmail: user.email,
                isFeatured: false, // ඔබ රිසිට් එක බලා මෙය True කරන තෙක් False වේ
                createdAt: firebase.firestore.FieldValue.serverTimestamp()
            });

            if (isFeatured) {
                // Premium නම් ගෙවීම් පිටුවට යවන්න (Email එක සහ Post Title එකත් සමඟ)
                const url = `payment.html?email=${encodeURIComponent(user.email)}&title=${encodeURIComponent(title)}`;
                window.location.href = url;
            } else {
                alert("දැන්වීම සාර්ථකව පළ කළා!");
                window.location.href = "index.html";
            }
        } catch (e) {
            alert("දෝෂයකි: " + e.message);
            btn.disabled = false;
        }
    }
</script>
