<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Post Ad | LankaAds</title>
    <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-firestore-compat.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 p-6">

<div class="max-w-2xl mx-auto bg-white p-8 rounded-lg shadow">
    <h2 class="text-2xl font-bold mb-6">Post Your Ad</h2>
    
    <input type="text" id="title" placeholder="Ad Title" class="w-full p-3 mb-4 border rounded"><br>
    <select id="category" class="w-full p-3 mb-4 border rounded">
        <option value="Vehicles">Vehicles</option>
        <option value="Electronics">Electronics</option>
        </select>
    <textarea id="description" placeholder="Description" class="w-full p-3 mb-6 border rounded" rows="4"></textarea><br>
    
    <button onclick="postAd()" class="w-full bg-primary text-white p-3 rounded font-semibold hover:bg-orange-600">Submit Ad</button>
</div>

<script>
    // ඔබේ Firebase Config (වැදගත්!)
    const firebaseConfig = {
        apiKey: "AIzaSyBvTTRbiSEyuYi7XCM5_tHvjaZzaFN_8IQ",
        authDomain: "add-ink.firebaseapp.com",
        projectId: "add-ink",
        storageBucket: "add-ink.firebasestorage.app",
        messagingSenderId: "752189116425",
        appId: "1:752189116425:web:0acf6e7b3f6b3629e3e8d8"
    };
    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const db = firebase.firestore();

    // *** මෙය වැදගත්: ලොග් වී සිටීදැයි පරීක්ෂා කිරීම ***
    auth.onAuthStateChanged(user => {
        if (!user) {
            // ලොග් වී නැත්නම් login පිටුවට යවන්න
            alert("Please Login first!");
            window.location.href = "login.html";
        }
    });

    function postAd() {
        const user = auth.currentUser;
        if (!user) return; // තවදුරටත් ලොග් වී නැත්නම් නතර කරන්න

        const title = document.getElementById('title').value;
        const category = document.getElementById('category').value;
        const description = document.getElementById('description').value;

        db.collection("posts").add({
            title: title,
            category: category,
            description: description,
            userId: user.uid, // පරිශීලකයාගේ ID එක
            timestamp: firebase.firestore.FieldValue.serverTimestamp()
        }).then(() => {
            alert("Ad Posted!");
            window.location.href = "index.html";
        });
    }
</script>
</body>
</html>
