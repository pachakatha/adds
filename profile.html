// profile.html එකට මේ code එකතු කරන්න (existing profile එකට)

// Email change function
async function changeEmail(newEmail) {
    const user = auth.currentUser;
    try {
        await updateEmail(user, newEmail);
        await updateDoc(doc(db, "users", user.uid), {
            email: newEmail
        });
        showToast('Email updated successfully!');
    } catch (error) {
        showToast('Error: ' + error.message, 'error');
    }
}

// Password change function
async function changePassword(currentPassword, newPassword) {
    const user = auth.currentUser;
    try {
        // Re-authenticate first
        const credential = firebase.auth.EmailAuthProvider.credential(
            user.email, 
            currentPassword
        );
        await user.reauthenticateWithCredential(credential);
        
        // Update password
        await updatePassword(user, newPassword);
        showToast('Password updated successfully!');
    } catch (error) {
        showToast('Error: ' + error.message, 'error');
    }
}

// Delete account function
async function deleteAccount() {
    if (confirm('Are you sure? This action cannot be undone!')) {
        const user = auth.currentUser;
        try {
            // Delete user data from Firestore
            await deleteDoc(doc(db, "users", user.uid));
            
            // Delete user's ads
            const adsQuery = query(collection(db, "posts"), where("authorId", "==", user.uid));
            const adsSnapshot = await getDocs(adsQuery);
            adsSnapshot.forEach(async (adDoc) => {
                await deleteDoc(doc(db, "posts", adDoc.id));
            });
            
            // Delete user account
            await deleteUser(user);
            
            window.location.href = 'signup.html';
        } catch (error) {
            showToast('Error: ' + error.message, 'error');
        }
    }
}